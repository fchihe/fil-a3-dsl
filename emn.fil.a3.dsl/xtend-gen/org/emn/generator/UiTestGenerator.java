/**
 * generated by Xtext 2.10.0
 */
package org.emn.generator;

import com.google.common.base.Objects;
import com.google.common.collect.Iterables;
import java.io.File;
import org.eclipse.emf.common.util.EList;
import org.eclipse.emf.ecore.EObject;
import org.eclipse.emf.ecore.resource.Resource;
import org.eclipse.xtend2.lib.StringConcatenation;
import org.eclipse.xtext.generator.AbstractGenerator;
import org.eclipse.xtext.generator.IFileSystemAccess2;
import org.eclipse.xtext.generator.IGeneratorContext;
import org.eclipse.xtext.xbase.lib.IterableExtensions;
import org.emn.uiTest.Click;
import org.emn.uiTest.Command;
import org.emn.uiTest.Fill;
import org.emn.uiTest.GoOn;
import org.emn.uiTest.Open;
import org.emn.uiTest.Select;
import org.emn.uiTest.Selector;
import org.emn.uiTest.Store;
import org.emn.uiTest.UiTest;
import org.emn.uiTest.Value;
import org.emn.uiTest.VariableDefinition;
import org.emn.uiTest.Verify;

/**
 * Generates code from your model files on save.
 * 
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#code-generation
 */
@SuppressWarnings("all")
public class UiTestGenerator extends AbstractGenerator {
  @Override
  public void doGenerate(final Resource resource, final IFileSystemAccess2 fsa, final IGeneratorContext context) {
    EList<EObject> _contents = resource.getContents();
    Iterable<UiTest> _filter = Iterables.<UiTest>filter(_contents, UiTest.class);
    UiTest _head = IterableExtensions.<UiTest>head(_filter);
    CharSequence _generateUiTest = this.generateUiTest(_head);
    fsa.generateFile((("browserAutomation" + File.separator) + "Main.java"), _generateUiTest);
  }
  
  public CharSequence generateUiTest(final UiTest uiTest) {
    StringConcatenation _builder = new StringConcatenation();
    _builder.append("package browserAutomation;");
    _builder.newLine();
    _builder.append("import java.io.File;");
    _builder.newLine();
    _builder.newLine();
    _builder.append("import org.openqa.selenium.By;");
    _builder.newLine();
    _builder.append("import org.openqa.selenium.Keys;");
    _builder.newLine();
    _builder.append("import org.openqa.selenium.WebDriver;");
    _builder.newLine();
    _builder.append("import org.openqa.selenium.chrome.ChromeDriver;");
    _builder.newLine();
    _builder.append("import org.openqa.selenium.firefox.FirefoxDriver;");
    _builder.newLine();
    _builder.append("import org.openqa.selenium.support.ui.Select;");
    _builder.newLine();
    _builder.append("class Main {");
    _builder.newLine();
    _builder.append("\t\t");
    _builder.append("public static void main(String[] args) {");
    _builder.newLine();
    {
      EList<Command> _commands = uiTest.getCommands();
      for(final Command c : _commands) {
        _builder.append("\t\t\t");
        CharSequence _generateCommand = this.generateCommand(c);
        _builder.append(_generateCommand, "\t\t\t");
        _builder.newLineIfNotEmpty();
      }
    }
    _builder.append("\t\t");
    _builder.append("}");
    _builder.newLine();
    _builder.append("\t");
    _builder.append("}");
    _builder.newLine();
    return _builder;
  }
  
  public CharSequence generateCommand(final Command c) {
    StringConcatenation _builder = new StringConcatenation();
    CharSequence _switchResult = null;
    boolean _matched = false;
    if (c instanceof Click) {
      _matched=true;
      _switchResult = this.generateClick(((Click)c));
    }
    if (!_matched) {
      if (c instanceof Open) {
        _matched=true;
        _switchResult = this.generateOpen(((Open)c));
      }
    }
    if (!_matched) {
      if (c instanceof GoOn) {
        _matched=true;
        _switchResult = this.generateGoOn(((GoOn)c));
      }
    }
    if (!_matched) {
      if (c instanceof Fill) {
        _matched=true;
        _switchResult = this.generateFill(((Fill)c));
      }
    }
    if (!_matched) {
      if (c instanceof Verify) {
        _matched=true;
        _switchResult = this.generateVerify(((Verify)c));
      }
    }
    if (!_matched) {
      if (c instanceof Store) {
        _matched=true;
        _switchResult = this.generateStore(((Store)c));
      }
    }
    if (!_matched) {
      if (c instanceof Select) {
        _matched=true;
        _switchResult = this.generateSelect(((Select)c));
      }
    }
    _builder.append(_switchResult, "");
    _builder.newLineIfNotEmpty();
    return _builder;
  }
  
  public CharSequence generateSelect(final Select s) {
    StringConcatenation _builder = new StringConcatenation();
    _builder.append("new Select(driver.findElement(By.xpath(\"");
    Selector _selector = s.getSelector();
    CharSequence _generateSelector = this.generateSelector(_selector);
    _builder.append(_generateSelector, "");
    _builder.append("\"))).selectByVisibleText(\"");
    Value _value = s.getValue();
    CharSequence _generateValue = this.generateValue(_value);
    _builder.append(_generateValue, "");
    _builder.append("\");");
    _builder.newLineIfNotEmpty();
    return _builder;
  }
  
  public CharSequence generateClick(final Click c) {
    StringConcatenation _builder = new StringConcatenation();
    _builder.append("driver.findElement(By.xpath(\"");
    Selector _selector = c.getSelector();
    CharSequence _generateSelector = this.generateSelector(_selector);
    _builder.append(_generateSelector, "");
    _builder.append("\")).click();");
    _builder.newLineIfNotEmpty();
    return _builder;
  }
  
  public CharSequence generateSelector(final Selector s) {
    StringConcatenation _builder = new StringConcatenation();
    {
      String _attributeName = s.getAttributeName();
      boolean _equals = _attributeName.equals("text");
      if (_equals) {
        _builder.append("//*[contains(text(), \'");
        String _attributeValue = s.getAttributeValue();
        _builder.append(_attributeValue, "");
        _builder.append("\')]");
      } else {
        _builder.append("//*[@");
        String _attributeName_1 = s.getAttributeName();
        _builder.append(_attributeName_1, "");
        _builder.append("=\\\"");
        String _attributeValue_1 = s.getAttributeValue();
        _builder.append(_attributeValue_1, "");
        _builder.append("\\\"]");
      }
    }
    return _builder;
  }
  
  public CharSequence generateOpen(final Open o) {
    StringConcatenation _builder = new StringConcatenation();
    _builder.append("File file = new File(\"C:\\\\Users\\\\Xavier\\\\Downloads\\\\chromedriver.exe\");");
    _builder.newLine();
    _builder.append("System.setProperty(\"webdriver.chrome.driver\", file.getAbsolutePath() );");
    _builder.newLine();
    _builder.append("WebDriver driver = new ChromeDriver();");
    _builder.newLine();
    return _builder;
  }
  
  public CharSequence generateGoOn(final GoOn g) {
    StringConcatenation _builder = new StringConcatenation();
    _builder.append("driver.get(\"");
    String _address = g.getAddress();
    _builder.append(_address, "");
    _builder.append("\");");
    _builder.newLineIfNotEmpty();
    return _builder;
  }
  
  public CharSequence generateFill(final Fill f) {
    StringConcatenation _builder = new StringConcatenation();
    _builder.append("driver.findElement(By.xpath(\"");
    Selector _selector = f.getSelector();
    CharSequence _generateSelector = this.generateSelector(_selector);
    _builder.append(_generateSelector, "");
    _builder.append("\")).sendKeys(\"");
    Value _value = f.getValue();
    CharSequence _generateValue = this.generateValue(_value);
    _builder.append(_generateValue, "");
    _builder.append("\");");
    _builder.newLineIfNotEmpty();
    return _builder;
  }
  
  public CharSequence generateValue(final Value v) {
    StringConcatenation _builder = new StringConcatenation();
    {
      String _stringValue = v.getStringValue();
      boolean _notEquals = (!Objects.equal(_stringValue, null));
      if (_notEquals) {
        String _stringValue_1 = v.getStringValue();
        _builder.append(_stringValue_1, "");
      } else {
        VariableDefinition _keyValue = v.getKeyValue();
        String _name = _keyValue.getName();
        _builder.append(_name, "");
      }
    }
    return _builder;
  }
  
  public CharSequence generateVerify(final Verify v) {
    StringConcatenation _builder = new StringConcatenation();
    _builder.append("verifiy;");
    _builder.newLine();
    return _builder;
  }
  
  public CharSequence generateStore(final Store s) {
    StringConcatenation _builder = new StringConcatenation();
    _builder.append("store;");
    _builder.newLine();
    return _builder;
  }
}
